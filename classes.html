<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Classes - Bobble</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Firebase SDKs (Compatibility Versions) -->
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database-compat.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="logo"><a href="index.html">Bobble</a></div>
            <div class="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                 <li class="dropdown">
                    <a href="classes.html" class="dropbtn">Classes</a>
                    <ul class="dropdown-menu">
                        <li><a href="classes.html">All Classes</a></li>
                        <li><a href="classes.html">Arts &amp; Crafts</a></li>
                        <li><a href="classes.html">Sports</a></li>
                    </ul>
                </li>
                <li><a href="about.html">About</a></li>
                <li><a href="account.html">Account</a></li>
                <li><a href="login.html">Login</a></li>
            </ul>
        </div>
    </nav>

    <section class="classes-section">
        <div class="container">
            <h2>Available Classes</h2>
            
            <!-- This grid will be populated dynamically -->
            <div class="classes-grid">
                <div class="loading-state" style="text-align: center; padding: 20px;">
                    <p>⏳ Loading classes from database...</p>
                </div>
            </div>
        </div>
    </section>

    <div id="footer-wrapper">
        <footer id="footer" class="container">
            <div class="row">
                <div class="col-3 col-6-medium col-12-small">
                    <section class="widget links">
                        <h3>Random Stuff</h3>
                        <ul class="style2">
                            <li><a href="#">Terms & Conditions</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                        </ul>
                    </section>
                </div>
                <div class="col-3 col-6-medium col-12-small">
                    <section class="widget contact last">
                        <h3>Contact Us</h3>
                        <p>1234 London Road<br />London, UK<br />(800) 555-0000</p>
                    </section>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div id="copyright">
                        <ul class="menu">
                            <li>&copy; Bobble 2024-2026. All rights reserved</li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script src="js/menu.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
          apiKey: "AIzaSyCm470tvi--eWD1LXpzgJpaZoVCM3XPB14",
          authDomain: "bobble-13959.firebaseapp.com",
          databaseURL: "https://bobble-13959-default-rtdb.europe-west1.firebasedatabase.app/",
          projectId: "bobble-13959",
          storageBucket: "bobble-13959.firebasestorage.app",
          messagingSenderId: "164832587163",
          appId: "1:164832587163:web:8ed8f747bac4b5f95cc53e"
        };

        try {
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            const auth = firebase.auth();
            const classesGrid = document.querySelector('.classes-grid');

            console.log("DEBUG: 1. Firebase initialized.");

            // To resolve permission_denied, we ensure the user is authenticated.
            auth.onAuthStateChanged((user) => {
                if (!user) {
                    console.log("DEBUG: 2. No user detected. Attempting anonymous sign-in...");
                    auth.signInAnonymously().catch(err => {
                        console.error("DEBUG ERROR: Anonymous Auth Failed. Make sure 'Anonymous' is enabled in Firebase Console > Auth > Sign-in method.", err);
                        classesGrid.innerHTML = `
                            <div style="color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 4px; text-align: left;">
                                <strong>Auth Error:</strong> Anonymous sign-in failed. <br><br>
                                <strong>Fix:</strong> Go to Firebase Console -> Authentication -> Sign-in method -> Enable "Anonymous".
                            </div>`;
                    });
                    return;
                }

                console.log("DEBUG: 3. Authenticated (UID: " + user.uid + "). Fetching classes...");

                // Listen for classes data
                database.ref('classes').on('value', (snapshot) => {
                    const classesData = snapshot.val();
                    classesGrid.innerHTML = '';

                    if (classesData) {
                        Object.entries(classesData).forEach(([id, classItem]) => {
                            const classCard = document.createElement('div');
                            classCard.className = 'class-card';
                            classCard.innerHTML = `
                                <h3>${classItem.name || 'Untitled Class'}</h3>
                                <p><strong>Instructor:</strong> ${classItem.instructor || 'TBD'}</p>
                                <p><strong>Time:</strong> ${classItem.time || 'N/A'}</p>
                                <p><strong>Duration:</strong> ${classItem.duration || 'N/A'}</p>
                                <p><strong>Level:</strong> ${classItem.level || 'All Levels'}</p>
                                <a href="individual_class_template.html?id=${id}" class="btn btn-primary">Explore Class</a>
                            `;
                            classesGrid.appendChild(classCard);
                        });
                        console.log('DEBUG: 4. UI updated with database classes.');
                    } else {
                        console.warn('DEBUG: ⚠️ Database node "classes" is empty.');
                        classesGrid.innerHTML = '<p>No classes found in the database.</p>';
                    }
                }, (error) => {
                    console.error('DEBUG ERROR: ❌ Database read failed.', error);
                    classesGrid.innerHTML = `
                        <div style="color: #856404; background-color: #fff3cd; border: 1px solid #ffeeba; padding: 15px; border-radius: 4px; text-align: left;">
                            <strong>Permission Error:</strong> You do not have permission to read this data. <br><br>
                            <strong>Fix:</strong> Check your Realtime Database "Rules" tab. Ensure ".read" is set to true or "auth != null".
                        </div>`;
                });
            });

        } catch (initError) {
            console.error('DEBUG ERROR: ❌ Firebase failed to load.', initError);
        }
    </script>
</body>
</html>