<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Classes - Bobble</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Firebase SDKs (Compatibility Versions) -->
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database-compat.js"></script>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="logo"><a href="index.html">Bobble</a></div>
            <div class="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                 <li class="dropdown">
                    <a href="classes.html" class="dropbtn">Classes</a>
                    <ul class="dropdown-menu">
                        <li><a href="classes.html">All Classes</a></li>
                        <li><a href="classes.html">Arts &amp; Crafts</a></li>
                        <li><a href="classes.html">Sports</a></li>
                    </ul>
                </li>
                <li><a href="about.html">About</a></li>
                <li><a href="account.html">Account</a></li>
                <li><a href="login.html">Login</a></li>
            </ul>
        </div>
    </nav>

    <section class="classes-section">
        <div class="container">
            <h2 id="class-venue">Loading...</h2>
            
            <div class="classes-grid">
                <div class="class-card" id="class-details">
                    <div style="text-align: center; padding: 20px;">
                        <p>‚è≥ Loading class details...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

 <div id="footer-wrapper">
        <footer id="footer" class="container">
            <div class="row">
                <div class="col-3 col-6-medium col-12-small">
                    <section class="widget links">
                        <h3>Random Stuff</h3>
                        <ul class="style2">
                            <li><a href="#">Etiam feugiat condimentum</a></li>
                            <li><a href="#">Aliquam imperdiet suscipit odio</a></li>
                        </ul>
                    </section>
                </div>
                <div class="col-3 col-6-medium col-12-small">
                    <section class="widget contact last">
                        <h3>Contact Us</h3>
                        <p>1234 Fictional Road<br />London, UK<br />(800) 555-0000</p>
                    </section>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div id="copyright">
                        <ul class="menu">
                            <li>&copy; Bobble 2024-2026. All rights reserved</li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <script src="js/menu.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
          apiKey: "AIzaSyCm470tvi--eWD1LXpzgJpaZoVCM3XPB14",
          authDomain: "bobble-13959.firebaseapp.com",
          databaseURL: "https://bobble-13959-default-rtdb.europe-west1.firebasedatabase.app/",
          projectId: "bobble-13959",
          storageBucket: "bobble-13959.firebasestorage.app",
          messagingSenderId: "164832587163",
          appId: "1:164832587163:web:8ed8f747bac4b5f95cc53e"
        };

        try {
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            const auth = firebase.auth();

            // Get class ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const classId = urlParams.get('id');

            const classDetailsDiv = document.getElementById('class-details');
            const classVenueHeading = document.getElementById('class-venue');

            if (!classId) {
                classDetailsDiv.innerHTML = `
                    <div style="color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 4px; text-align: left;">
                        <strong>Error:</strong> No class ID provided in the URL.
                    </div>`;
                return;
            }

            console.log("DEBUG: Class ID from URL:", classId);

            auth.onAuthStateChanged((user) => {
                if (!user) {
                    console.log("DEBUG: No user detected. Attempting anonymous sign-in...");
                    auth.signInAnonymously().catch(err => {
                        console.error("DEBUG ERROR: Anonymous Auth Failed.", err);
                        classDetailsDiv.innerHTML = `
                            <div style="color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 4px; text-align: left;">
                                <strong>Auth Error:</strong> Anonymous sign-in failed.
                            </div>`;
                    });
                    return;
                }

                console.log("DEBUG: Authenticated. Fetching class data for ID:", classId);

                // Set a timeout to prevent infinite loading
                const timeoutId = setTimeout(() => {
                    console.error('DEBUG ERROR: Request timed out after 10 seconds');
                    classDetailsDiv.innerHTML = `
                        <div style="color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 4px; text-align: left;">
                            <strong>Error:</strong> Request timed out. The database may not have permission to read individual class data.
                        </div>`;
                }, 10000);

                // Fetch specific class data from Real-time Database
                const ref = database.ref('classes/' + classId);
                ref.on('value', (snapshot) => {
                    clearTimeout(timeoutId);
                    const classData = snapshot.val();

                    if (classData) {
                        console.log('DEBUG: Class data retrieved:', classData);
                        
                        classVenueHeading.textContent = classData.venue || 'Class Venue';
                        
                        classDetailsDiv.innerHTML = `
                            <h3>${classData.name || 'Untitled Class'}</h3>
                            <p><strong>Instructor:</strong> ${classData.instructor || 'TBD'}</p>
                            <p><strong>Description:</strong> ${classData.description || 'No description available'}</p>
                            <p><strong>Time:</strong> ${classData.time || 'N/A'}</p>
                            <p><strong>Duration:</strong> ${classData.duration || 'N/A'}</p>
                            <p><strong>Level:</strong> ${classData.level || 'All Levels'}</p>
                            <p><strong>Location:</strong> ${classData.location || 'Address not provided'}</p>
                            ${classData.imageUrl ? `<img src="${classData.imageUrl}" alt="${classData.name}" style="margin-left: 50px; margin-top: 20px; max-width: 300px;">` : ''}
                        `;
                    } else {
                        console.warn('DEBUG: No data found for class ID:', classId);
                        classDetailsDiv.innerHTML = `
                            <div style="color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 4px; text-align: left;">
                                <strong>Error:</strong> Class not found in the database. Class ID: ${classId}
                            </div>`;
                    }
                }, (error) => {
                    clearTimeout(timeoutId);
                    console.error('DEBUG ERROR: Real-time Database read failed.', error);
                    classDetailsDiv.innerHTML = `
                        <div style="color: #856404; background-color: #fff3cd; border: 1px solid #ffeeba; padding: 15px; border-radius: 4px; text-align: left;">
                            <strong>Permission Error:</strong> Unable to fetch class data. <br><br>
                            <strong>Details:</strong> ${error.message} <br><br>
                            <strong>Fix:</strong> Check your Real-time Database "Rules" tab. Ensure anonymous users can read from the "classes" path.
                        </div>`;
                });
            });

        } catch (initError) {
            console.error('DEBUG ERROR: Firebase failed to load.', initError);
        }
    </script>
</body>
</html>
