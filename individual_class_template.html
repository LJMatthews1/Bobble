<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Details - Bobble</title>
    <script src="js/password-protect.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <!-- Firebase SDKs (Compatibility Versions) -->
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database-compat.js"></script>
</head> <!-- Added missing head closing tag -->
<body>
    <nav class="navbar">
        <div class="container">
            <a class="logo" href="index.html">Bobble</a>
            <div class="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="classes.html">Classes</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="/account.html">Account</a></li>
                <li><a href="/login.html">Login</a></li>
            </ul>
        </div>
    </nav>

    <section class="classes-section">
        <div class="container">
            <!-- This will show the category or name as a heading -->
            <h2 id="class-main-title">Loading Class...</h2>
            
            <div class="classes-grid" style="display: block;"> <!-- Changed to block for a detail view -->
                <div class="class-card" id="class-details" style="max-width: 800px; margin: 0 auto; text-align: left;">
                    <div style="text-align: center; padding: 20px;">
                        <p>‚è≥ Fetching details from Bobble Database...</p>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <a href="classes.html" class="btn">Back to All Classes</a>
            </div>
        </div>
    </section>

    <footer id="footer" class="container">
        <div id="copyright" style="text-align: center; padding: 20px;">
            <p>&copy; Bobble 2024-2026. All rights reserved</p>
        </div>
    </footer>

    <script src="js/menu.js"></script>
    <script>
        // Firebase Configuration (Must match classes.html)
        const firebaseConfig = {
          apiKey: "AIzaSyCm470tvi--eWD1LXpzgJpaZoVCM3XPB14",
          authDomain: "bobble-13959.firebaseapp.com",
          databaseURL: "https://bobble-13959-default-rtdb.europe-west1.firebasedatabase.app/",
          projectId: "bobble-13959",
          storageBucket: "bobble-13959.firebasestorage.app",
          messagingSenderId: "164832587163",
          appId: "1:164832587163:web:8ed8f747bac4b5f95cc53e"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            const auth = firebase.auth();

            // 1. Get ID from URL (e.g., ?id=class_001)
            const urlParams = new URLSearchParams(window.location.search);
            const classId = urlParams.get('id');
            console.log("DEBUG: URL Class ID found:", classId);

            const classDetailsDiv = document.getElementById('class-details');
            const mainTitle = document.getElementById('class-main-title');

            if (!classId) {
                console.error("DEBUG ERROR: No ID in URL. Did you click a link from classes.html?");
                classDetailsDiv.innerHTML = `<p style="color:red;">Error: No class selected. Please go back to the classes page.</p>`;
            } else {
                // 2. Auth Check (needed if rules are auth != null)
                auth.onAuthStateChanged((user) => {
                    if (!user) {
                        console.log("DEBUG: Signing in anonymously for detail view...");
                        auth.signInAnonymously();
                        return;
                    }

                    console.log("DEBUG: Connected as", user.uid, "- Fetching data for", classId);

                    // 3. Fetch from Real-time Database
                    // Path is 'classes/class_001'
                    database.ref('classes/' + classId).on('value', (snapshot) => {
                        const data = snapshot.val();
                        
                        if (data) {
                            console.log("DEBUG: Data received from Firebase:", data);
                            
                            // Update page Title
                            mainTitle.textContent = data.name || "Class Details";

                            // Update HTML content
                            // Note: mapped to the fields in your JSON (name, instructor, time, level, description)
                            classDetailsDiv.innerHTML = `
                                <div style="padding: 20px;">
                                    <h3 style="font-size: 2em; margin-bottom: 10px;">${data.name}</h3>
                                    <p style="color: #e74c3c; font-weight: bold; margin-bottom: 20px;">${data.category || 'General'}</p>
                                    
                                    <p><strong>Instructor:</strong> ${data.instructor}</p>
                                    <p><strong>When:</strong> ${data.time}</p>
                                    <p><strong>Duration:</strong> ${data.duration}</p>
                                    <p><strong>Difficulty:</strong> ${data.level}</p>
                                    
                                    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                                    
                                    <h4>About this class</h4>
                                    <p style="line-height: 1.6;">${data.description || 'No description provided for this session.'}</p>
                                    
                                    <div style="margin-top: 30px;">
                                        <button class="btn btn-primary" onclick="alert('Booking feature coming soon!')">Book with Credits</button>
                                    </div>
                                </div>
                            `;
                        } else {
                            console.warn("DEBUG ERROR: Path 'classes/" + classId + "' exists but has no data.");
                            classDetailsDiv.innerHTML = `<p>Class not found in database. (ID: ${classId})</p>`;
                        }
                    }, (error) => {
                        console.error("DEBUG ERROR: Database read failed:", error);
                        classDetailsDiv.innerHTML = `<p>Error loading data: ${error.message}</p>`;
                    });
                });
            }

        } catch (err) {
            console.error("DEBUG ERROR: Firebase Init failed:", err);
        }
    </script>
</body>
</html>